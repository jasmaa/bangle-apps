// Based on: https://github.com/espruino/BangleApps/blob/master/apps/antonclk/app.js

require("Font7x11Numeric7Seg").add(Graphics);

let X = 145, Y = 100;

function bgImg() {
  return require("heatshrink").decompress(atob("2GwyEB7eEAP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4B/AP4BLgAA/AH4A/AH4A/AAXbwgBXDYP/AH4A/AH4A/AH4ACgEA7eEAKYXBLP4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AHgEA7eEAKIVBK/4A/AH4A/AH4AFgEA7eEAKoZBLf4A/AH7rRAH4Ax7eEALJb/AH4Ax/4AadboB/AP4BXf9oAbRP6LD/4AYL/4B/Z+oA/ACKP9/4AWK/oB/Zu4A/ACqR7/4AUKfYB/ZfIA/ADJdPSdP/ACQ/pAP4B/ZJYA/AF6Vl/4AQHMoB/AP7HPAH4A1S8P/ABwzhAP4B/YqYA/AHKZf/4AMF74B/AP7DVAH4A/Tbf/ABQpbAP4B/X64A/AH4AFT7P/ABAlZAP4B/Xa4A/AH4AJUbP/AAwjZAP4B/XK4A/AH4ANUq//AAgfXAP4B/AK7/xAH4AhU6v/AAQbVAP4B/ALL/1AH4AfVKv//4ZVAP4B/ALL/3AH4AfVa7v/AP4Bvf+4A/AEKrTdv4B/AOL/5AH4AfbP4B/AP4BDf/YA/AELd/AP4B/AIL/9AH4Afbv4B/AP7//AH4Afb/4B/AP7//AH4Afb/4B/AP7//AH4AhcP4B/APr9/AH4AhcP4B/APr9/AH4AhcP4B/APr9/AH4Ajcf4B/APb7/AH4Ajcf4B/APL5/AH4Alcv4B/APL5/AH4Anc/4B/AO73/AH4Anc/4B/AO73/AH4ApdP4B/AOr1/AH4ApdP4B/AOr1/AH4Ardf4B/AOLx/AH4AtXZ79/AP4BheP4A/AF69Pf/4B/AL7v/AH4AtXqb/9AP4Bdd/4AbLv5VXX57/7AP4Bfdv4AbLv5XZXpb/9AP4Bfdf4AbLv5ZbXY7//AP4BfdP4AZ///Lv4Ahfv4BvPN7f/ADf//5h/ADrhlAP4BHOZJ7rcf4AZ/4AEMNIpla84B/AJ55JQtb7nAGv/AAgfZP5qNlbM4B/AJZ3LQdrRjAGpbJMp4ZVRc7bpAP4BHOZaDtaMoAxMpv//4dPBKI3LLdYB/AMJxLQN7JdAG//ACQfLO5IJLAIYrFS7rdpAP4BFOJaBvY7YAr///JZILBACotJFY4VLFa4ARbtIB/AIpxJX56TfYrYAt///Jo4JBADKfNCZYjPTbbLVAP4BXN5aDTSLbDZAF///4FFABYbJCKIVJEJJrnZq4B/AKpvJQaKPfF5bdnACv/ABQhdFp41dACbPZAP4BTN5KDNRsYhLb9IAR/4AKEsIxPGroARaLYB/AKJvHReYfJb9YAR/4AIEsoAPWKJHbaboB/AKJxFRPorDabYAd/4AGQbInNAB5LRRrbVpAP6FbQ9YtFJbYAd/4AEDbZdFBYoAPFJIjLa/4B/XpaTTJdpRJAGJ7RCoqhPMIKtNWp4JFZaYATb9YBvW5qvTJ95VHAGZ1NCpIdLADYzHGIpNHR66xLAP4BTWcqJJKMZZJAGZvJBI4VFDpKtjJpYABR7KzNAP4BPV8q1HKc4HHcZLbVAC4vFO5IbNVcotNRoKDXWZoB/AJqtnWpJTjAo7jJbKoAZGII9FOo4bNVc4rJJoJHRAA6tFbMYBvVdK1LKb6xHBYpjDBZIAnNIYzFOo4ZLAG5rVVo4B/AJ6r3RbqvHA4a/FGIrbVAC5pFUZIXNAC7TfOLbTbAOqtfUrJTbA44JDXIoxHbrYAPNY43DTNKBHXLIARVY4B/AJ7DFa64bdR7IZFW5I3FCpIAnQ5YArM4YdZNKa3HabIB1YY5rNVZrxVC4ZVZGo49JMYbDHAFKJLAH4AHM6a5LAP4BLYJJpJR54lDdqIVFKq5NJHZItFbqbvVOJ4A/dJ5vPOYrRVAOq/NM4qBLBooABdaaNbW5YJHGY4dLADYpHOpoA/bpZvVaKoB1XqpjJBIajVD5JbZABepwxrDDKYAXO6oA/boYAbZ7IBzYqZjNBoYjRDpYBTA"))
}

let drawTimeout;

let draw = function () {
  var date = new Date();
  var timeStr = require("locale").time(date, 1);
  var meridiem = require("locale").meridian(date)
  g.reset();
  g.clearRect(20, Y - 50, 150, Y);
  g.setFont("7x11Numeric7Seg", 4);
  g.setFontAlign(1, 1);
  g.drawString(timeStr, X, Y, true);
  g.setFont("4x6", 3);
  g.drawString(meridiem, X + 25, Y, true);

  // queue next draw
  if (drawTimeout) clearTimeout(drawTimeout);
  drawTimeout = setTimeout(function () {
    drawTimeout = undefined;
    draw();
  }, 60000 - (Date.now() % 60000));
}

Bangle.setUI({
  mode: "clock",
  remove: function () {
    // Called to unload all of the clock app
    if (drawTimeout) clearTimeout(drawTimeout);
    drawTimeout = undefined;
  }
});

g.clear();
g.drawImage(bgImg(), 0, 0);

Bangle.loadWidgets();
draw();
setTimeout(Bangle.drawWidgets, 0);